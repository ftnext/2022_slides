
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <title>Norm@lizerï¼ˆæ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†ã«ã¤ã„ã¦ï¼‰</title>
    <link rel="stylesheet" type="text/css" href="../_static/revealjs4/dist/reveal.css" />
    <link rel="stylesheet" href="../_static/revealjs4/dist/theme/black.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/revealjs4/plugin/highlight/zenburn.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/common.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æ¤œç´¢" href="../search.html" />
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    


    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ftnext">
    <meta property="og:url" content="https://ftnext.github.io/2022_slides/hannari_Dec/normalize_text.html">
    <meta property="og:title" content="Norm@lizerï¼ˆæ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†ã«ã¤ã„ã¦ï¼‰">
    <meta property="og:description" content="2022/12 ã¯ã‚“ãªã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ä¼š ãƒœãƒ¼ãƒãƒ³LTä¼š LT ã‚¹ãƒ©ã‚¤ãƒ‰">
    <meta property="og:image" content="https://ftnext.github.io/2022_slides/_static/ogps/hannari_Dec.png">

  </head><body>
    <div class="reveal">
        <div class="slides">
            <section >
<h1>Norm&#64;lizerï¼ˆæ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†ã«ã¤ã„ã¦ï¼‰</h1>
<dl class="field-list simple">
<dt class="field-odd">Event<span class="colon">:</span></dt>
<dd class="field-odd"><p>ãƒœãƒ¼ãƒãƒ³LTä¼š ã¯ã‚“ãªã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ä¼š</p>
</dd>
<dt class="field-even">Presented<span class="colon">:</span></dt>
<dd class="field-even"><p>2022/12/16 nikkie</p>
</dd>
</dl>
</section>
<section >
<h2>ãŠå‰ã€èª°ã‚ˆ</h2>
<ul class="simple">
<li><p><strong>Python</strong> å¤§å¥½ãã€ã«ã£ããƒ¼ï¼ˆ<a class="reference external" href="https://2022.pycon.jp/timetable?id=LPYF7C">ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯å¥½ã</a>ï¼‰</p></li>
<li><p><span class="fab fa-twitter"></span> <a class="reference external" href="https://twitter.com/ftnext">&#64;ftnext</a> ï¼ <span class="fab fa-github"></span> <a class="reference external" href="https://github.com/ftnext">&#64;ftnext</a> ï¼ <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/">ã¯ã¦ãªãƒ–ãƒ­ã‚°</a></p></li>
<li><p>æ ªå¼ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ™ãƒ¼ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆï¼ˆè‡ªç„¶è¨€èªå‡¦ç†ã€XPï¼‰</p></li>
<li><p>è¿‘æ±Ÿå½¼æ–¹ã•ã‚“ã€ãŠã‚ã§ã¨ã†ğŸ‚ğŸ‘</p></li>
</ul>
</section>
<section>
<section >
<h2>æœ¬ç·¨ï¼šè‡ªç„¶è¨€èªå‡¦ç†ã®è©±ã§ã™</h2>
<ul class="simple">
<li><p>æ—¥æœ¬èªã¯æ–‡ã®ä¸­ã®å˜èªãŒåŒºåˆ‡ã‚‰ã‚Œã¦ã„ãªã„</p></li>
<li><p><strong>å½¢æ…‹ç´ è§£æ</strong> ã—ã¦</p>
<ul>
<li><p>å˜èªåˆ†å‰²ï¼åˆ†ã‹ã¡æ›¸ã</p></li>
<li><p>å“è©ä»˜ä¸</p></li>
</ul>
</li>
</ul>
</section>
<section >
<h3>ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ å½¢æ…‹ç´ è§£æã‚¨ãƒ³ã‚¸ãƒ³ã€MeCab</h3>
<blockquote>
<div><p>è¨€èª, è¾æ›¸,ã‚³ãƒ¼ãƒ‘ã‚¹ã«ä¾å­˜ã—ãªã„æ±ç”¨çš„ãªè¨­è¨ˆ</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference external" href="https://taku910.github.io/mecab/">https://taku910.github.io/mecab/</a></p></li>
</ul>
</section>
<section >
<h3>å½¢æ…‹ç´ è§£æã«ä½¿ã†è¾æ›¸</h3>
<ul class="simple">
<li><p>MeCabã®è¾æ›¸ã®1ã¤ mecab-ipadic-NEologd</p></li>
<li><p><span class="fab fa-github"></span> <a class="reference external" href="https://github.com/neologd/mecab-ipadic-neologd">https://github.com/neologd/mecab-ipadic-neologd</a></p></li>
</ul>
</section>
<section >
<h3>mecab-ipadic-NEologd ã‚’ä½œã‚‹ä¸Šã§</h3>
<ul class="simple">
<li><p><em>è§£æå‰ã«è¡Œã†ã“ã¨ãŒæœ›ã¾ã—ã„æ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†</em></p></li>
<li><p><a class="reference external" href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja</a></p></li>
<li><p>ã“ã‚Œã‚’ <strong>ç†è§£ã—ã€çœŸä¼¼ã‚‹</strong> ã®ãŒä»Šå›ã®LTã§ã™</p></li>
</ul>
</section>
</section>
<section >
<h2>Part 1ï¸âƒ£ æ­£è¦åŒ–å‡¦ç† ã‚¯ãƒ­ãƒ¼ã‚ºã‚¢ãƒƒãƒ—</h2>
<ul class="simple">
<li><p>ã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤</p></li>
<li><p>ç½®æ›</p></li>
<li><p>å…¨è§’ãƒ»åŠè§’å¤‰æ›</p></li>
</ul>
</section>
<section >
<h2><strong>å…ˆé ­</strong> ã¨ <strong>æœ«å°¾</strong> ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤</h2>
<pre data-id="id6"><code data-trim data-noescape class="python">&gt;&gt;&gt; &quot;      ãƒ†ã‚­ã‚¹ãƒˆã®å‰&quot;.strip()
'ãƒ†ã‚­ã‚¹ãƒˆã®å‰'
&gt;&gt;&gt; &quot;ãƒ†ã‚­ã‚¹ãƒˆã®å¾Œ      &quot;.strip()
'ãƒ†ã‚­ã‚¹ãƒˆã®å¾Œ'</code></pre>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#str.strip">https://docs.python.org/ja/3/library/stdtypes.html#str.strip</a></p>
</section>
<section>
<section >
<h2>æ–‡å­—ã‚’ç½®æ› <code class="code docutils literal notranslate"><span class="pre">re.sub(pattern,</span> <span class="pre">repl,</span> <span class="pre">string)</span></code></h2>
<blockquote>
<div><p>string ä¸­ã«å‡ºç¾ã™ã‚‹æœ€ã‚‚å·¦ã®é‡è¤‡ã—ãªã„ pattern ã‚’ç½®æ› repl ã§ç½®æ›ã™ã‚‹ã“ã¨ã§å¾—ã‚‰ã‚Œã‚‹æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™ã€‚</p>
</div></blockquote>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/re.html#re.sub">https://docs.python.org/ja/3/library/re.html#re.sub</a></p>
<p>â—ï¸replãŒé–¢æ•°ã®ã¨ãã¯ã€å‹•ããŒã¡ã‚‡ã£ã¨ç•°ãªã‚Šã¾ã™</p>
</section>
<section >
<h3>æ–‡å­—ã‚’ç½®æ›ã—ã¦æƒãˆã‚‹</h3>
<ul class="simple">
<li><p>ãƒã‚¤ãƒ•ãƒ³ãƒã‚¤ãƒŠã‚¹ã£ã½ã„æ–‡å­—ã¯ <code class="docutils literal notranslate"><span class="pre">-</span></code> <em>HYPHEN-MINUS</em> ã«</p></li>
<li><p>é•·éŸ³è¨˜å·ã£ã½ã„æ–‡å­—ã¯ <code class="docutils literal notranslate"><span class="pre">ãƒ¼</span></code> <em>KATAKANA-HIRAGANA PROLONGED SOUND MARK</em> ã«</p>
<ul>
<li><p>1å›ä»¥ä¸Šé€£ç¶šã™ã‚‹é•·éŸ³è¨˜å·ã¯1ã¤ã«ã¾ã¨ã‚ã‚‹</p></li>
</ul>
</li>
</ul>
</section>
<section >
<h3>æ–‡å­—ã‚’ç½®æ›ã—ã¦æƒãˆã‚‹</h3>
<pre data-id="id7"><code data-trim data-noescape class="python">&gt;&gt;&gt; import re
&gt;&gt;&gt; # ãƒã‚¤ãƒ•ãƒ³ãƒã‚¤ãƒŠã‚¹ã£ã½ã„æ–‡å­—ã‚’æƒãˆã‚‹
&gt;&gt;&gt; re.sub(&quot;[Ë—ÖŠâ€â€‘â€’â€“âƒâ»â‚‹âˆ’]+&quot;, &quot;-&quot;, &quot;oâ‚‹o&quot;)
'o-o'
&gt;&gt;&gt; # é•·éŸ³è¨˜å·ã£ã½ã„æ–‡å­—ã‚’æƒãˆã‚‹
&gt;&gt;&gt; # &amp; 1å›ä»¥ä¸Šé€£ç¶šã™ã‚‹é•·éŸ³è¨˜å·ã¯1ã¤ã«ã¾ã¨ã‚ã‚‹ï¼ˆreplã®ãƒ¼ã¯patternã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼‰
&gt;&gt;&gt; re.sub(&quot;[ï¹£ï¼ï½°â€”â€•â”€â”ãƒ¼]+&quot;, &quot;ãƒ¼&quot;, &quot;majikaâ”&quot;)
'majikaãƒ¼'
&gt;&gt;&gt; re.sub(&quot;[ï¹£ï¼ï½°â€”â€•â”€â”ãƒ¼]+&quot;, &quot;ãƒ¼&quot;, &quot;ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¼ãƒ¼ãƒ¼&quot;)
'ã‚¹ãƒ¼ãƒ‘ãƒ¼'</code></pre>
</section>
<section >
<h3>ç©ºæ–‡å­—åˆ—ã«ç½®æ›ï¼ˆï¼å‰Šé™¤ï¼‰</h3>
<ul class="simple">
<li><p>ãƒãƒ«ãƒ€ã£ã½ã„æ–‡å­—ã¯å‰Šé™¤</p></li>
</ul>
<pre data-id="id8"><code data-trim data-noescape class="python">&gt;&gt;&gt; re.sub(&quot;[~âˆ¼âˆ¾ã€œã€°ï½]&quot;, &quot;&quot;, &quot;ã‚ã€°ã„&quot;)
'ã‚ã„'</code></pre>
</section>
</section>
<section>
<section >
<h2>å…¨è§’ãƒ»åŠè§’å¤‰æ› <code class="code docutils literal notranslate"><span class="pre">unicodedata.normalize(form,</span> <span class="pre">unistr)</span></code></h2>
<blockquote>
<div><div class="line-block">
<div class="line">Unicode æ–‡å­—åˆ— unistr ã®æ­£è¦å½¢ form ã‚’è¿”ã—ã¾ã™ã€‚</div>
<div class="line">form ã®æœ‰åŠ¹ãªå€¤ã¯ã€'NFC'ã€'NFKC'ã€'NFD'ã€'NFKD' ã§ã™ã€‚</div>
</div>
</div></blockquote>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/unicodedata.html#unicodedata.normalize">https://docs.python.org/ja/3/library/unicodedata.html#unicodedata.normalize</a></p>
</section>
<section >
<h3><strong>å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«</strong> ç½®æ›ã§ãã‚‹</h3>
<pre data-id="id9"><code data-trim data-noescape class="python">&gt;&gt;&gt; import unicodedata
&gt;&gt;&gt; unicodedata.normalize(&quot;NFKC&quot;, &quot;ï¼ï¼‘ï¼’ï¼¡ï¼¢ï¼£ï½˜ï½™ï½š&quot;)
'012ABCxyz'</code></pre>
</section>
<section >
<h3><strong>åŠè§’ã‚«ã‚¿ã‚«ãƒŠã‚’å…¨è§’ã«</strong> ç½®æ›ã§ãã‚‹</h3>
<pre data-id="id10"><code data-trim data-noescape class="python">&gt;&gt;&gt; hankaku = &quot;ï¾Šï¾ï½¶ï¾ï½¸&quot;
&gt;&gt;&gt; len(hankaku)
5
&gt;&gt;&gt; unicodedata.normalize(&quot;NFKC&quot;, hankaku)
'ãƒãƒ³ã‚¬ã‚¯'
&gt;&gt;&gt; len(_)
4</code></pre>
</section>
<section >
<h3>å…¨è§’è‹±æ•°å­—ã¨åŠè§’ã‚«ã‚¿ã‚«ãƒŠã«ã¤ã„ã¦å‡¦ç†</h3>
<pre data-id="id11"><code data-trim data-noescape class="python">&gt;&gt;&gt; import re
&gt;&gt;&gt; import unicodedata
&gt;&gt;&gt; # å…¨è§’è‹±æ•°å­—ã¨åŠè§’ã‚«ã‚¿ã‚«ãƒŠã‚’è¡¨ã™æ­£è¦è¡¨ç¾
&gt;&gt;&gt; pattern = re.compile(&quot;([ï¼-ï¼™ï¼¡-ï¼ºï½-ï½šï½¡-ï¾Ÿ]+)&quot;)
&gt;&gt;&gt; &quot;&quot;.join(
...     unicodedata.normalize(&quot;NFKC&quot;, x) if pattern.match(x) else x
...     for x in re.split(pattern, &quot;ï¼ï¼‘ï¼’ï¼¡ï¼¢ï¼£ï½˜ï½™ï½šã¯ï¾Šï¾ï½¶ï¾ï½¸&quot;)
... )
'012ABCxyzã¯ãƒãƒ³ã‚¬ã‚¯'</code></pre>
</section>
<section >
<h3>è£œè¶³æƒ…å ±ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p>ã™ã¹ã¦ã®æ–‡å­—ã‚’NFKCã«æ­£è¦åŒ–ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚‚ã‚ã‚Šã¾ã™ï¼ˆã€<a class="reference external" href="https://www.ohmsha.co.jp/book/9784274227264/">BERTã«ã‚ˆã‚‹è‡ªç„¶è¨€èªå‡¦ç†å…¥é–€</a>ã€ï¼‰</p></li>
<li><p>ã€ŒNFKCã¨ã‹NFKDã¨ã‹ã£ã¦ãªã‚“ã ï¼ï¼Ÿã€ğŸ‘‰ã€<a class="reference external" href="https://gihyo.jp/book/2019/978-4-297-10291-3">ãƒ—ãƒ­ã‚°ãƒ©ãƒã®ãŸã‚ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰æŠ€è¡“å…¥é–€</a>ã€ä»˜éŒ²A.4</p></li>
</ul>
</section>
</section>
<section>
<section >
<h2>å…¨è§’ãƒ»åŠè§’å¤‰æ› <strong>è¨˜å·</strong> ç·¨</h2>
<ul class="simple">
<li><p>åŠè§’ã«æƒãˆãŸã„è¨˜å·</p></li>
<li><p>å…¨è§’ã«æƒãˆãŸã„è¨˜å·</p></li>
</ul>
</section>
<section >
<h3>ä»¥ä¸‹ã®å¤‰æ›ãƒ«ãƒ¼ãƒ«ã¨ã™ã‚‹</h3>
<ul class="simple">
<li><p>ä»¥ä¸‹ã®å…¨è§’è¨˜å·ã¯åŠè§’ã«ç½®æ›</p>
<ul>
<li><p>/ï¼â€ï¼ƒï¼„ï¼…ï¼†â€™ï¼ˆï¼‰ï¼Šï¼‹ï¼Œâˆ’ï¼ï¼ï¼šï¼›ï¼œï¼ï¼Ÿï¼ ï¼»ï¿¥ï¼½ï¼¾ï¼¿ï½€ï½›ï½œï½</p></li>
</ul>
</li>
<li><p>ä»¥ä¸‹ã®åŠè§’è¨˜å·ã¯å…¨è§’ã«ç½®æ›</p>
<ul>
<li><p>ï½¡ï½¤ï½¥=ï½¢ï½£</p></li>
</ul>
</li>
</ul>
</section>
<section >
<h3>ä»Šå›ç´¹ä»‹ã™ã‚‹å®Ÿè£…</h3>
<ol class="arabic simple">
<li><p>è¨˜å·ã‚’ <strong>å…¨è§’ã«æƒãˆã‚‹</strong></p></li>
<li><p>åŠè§’ã«ç½®æ›ã™ã‚‹è¨˜å·ã ã‘ç½®æ›ã™ã‚‹</p></li>
</ol>
</section>
<section >
<h3><code class="code docutils literal notranslate"><span class="pre">str.translate(table)</span></code></h3>
<blockquote>
<div><p>ä¸ãˆã‚‰ã‚ŒãŸå¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ã«åŸºã¥ã„ã¦æ–‡å­—åˆ—ã‚’æ§‹æˆã™ã‚‹å„æ–‡å­—ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ãƒãƒƒãƒ”ãƒ³ã‚°å¾Œã®æ–‡å­—åˆ—ã®ã‚³ãƒ”ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚</p>
</div></blockquote>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#str.translate">https://docs.python.org/ja/3/library/stdtypes.html#str.translate</a></p>
</section>
<section >
<h3><code class="code docutils literal notranslate"><span class="pre">str.translate(table)</span></code></h3>
<blockquote>
<div><p>æ–‡å­—ã‹ã‚‰æ–‡å­—ã¸ã®ç•°ãªã‚‹å½¢å¼ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‹ã‚‰å¤‰æ›ãƒãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€ <code class="code docutils literal notranslate"><span class="pre">str.maketrans()</span></code> ãŒä½¿ãˆã¾ã™ã€‚</p>
</div></blockquote>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#str.translate">https://docs.python.org/ja/3/library/stdtypes.html#str.translate</a></p>
</section>
<section >
<h3><code class="code docutils literal notranslate"><span class="pre">str.maketrans</span></code></h3>
<pre data-id="str-maketrans"><code data-trim data-noescape class="python">&gt;&gt;&gt; mapping = str.maketrans(
...     '!&quot;#$%&amp;\'()*+,-./:;&lt;=&gt;?&#64;[Â¥]^_`{|}~ï½¡ï½¤ï½¥ï½¢ï½£',
...     &quot;ï¼â€ï¼ƒï¼„ï¼…ï¼†â€™ï¼ˆï¼‰ï¼Šï¼‹ï¼Œï¼ï¼ï¼ï¼šï¼›ï¼œï¼ï¼ï¼Ÿï¼ ï¼»ï¿¥ï¼½ï¼¾ï¼¿ï½€ï½›ï½œï½ã€œã€‚ã€ãƒ»ã€Œã€&quot;
... )
&gt;&gt;&gt; ord(&quot;#&quot;)
35
&gt;&gt;&gt; mapping[ord(&quot;#&quot;)]  # Unicodeã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–“ã®å¤‰æ›ã‚’è¡¨ã™
65283
&gt;&gt;&gt; chr(_)
'ï¼ƒ'</code></pre>
</section>
<section >
<h3>å¤‰æ›ãƒãƒƒãƒ—ã‚’ä½¿ã£ã¦ <code class="code docutils literal notranslate"><span class="pre">str.translate</span></code></h3>
<pre data-id="str-translate"><code data-trim data-noescape class="python">&gt;&gt;&gt; &quot;!#&quot;.translate(mapping)
'ï¼ï¼ƒ'</code></pre>
<p>è¨˜å·ã‚’å…¨è§’ã«æƒãˆã‚‰ã‚Œã‚‹ï¼</p>
</section>
<section >
<h3>åŠè§’ã«ç½®æ›ã™ã‚‹è¨˜å·ã ã‘ç½®æ›ã™ã‚‹</h3>
<p>å†åº¦ã® <code class="code docutils literal notranslate"><span class="pre">unicodedata.normalize</span></code></p>
<pre data-id="id18"><code data-trim data-noescape class="python">&gt;&gt;&gt; unicodedata.normalize(&quot;NFKC&quot;, &quot;ï¼ï¼ƒ&quot;)  # åŠè§’ã«æˆ»ã‚‹
'!#'
&gt;&gt;&gt; pattern = re.compile(&quot;([ï¼â€ï¼ƒï¼„ï¼…ï¼†â€™ï¼ˆï¼‰ï¼Šï¼‹ï¼Œï¼ï¼ï¼ï¼šï¼›ï¼œï¼ï¼Ÿï¼ ï¼»ï¿¥ï¼½ï¼¾ï¼¿ï½€ï½›ï½œï½ã€œ]+)&quot;)
&gt;&gt;&gt; &quot;&quot;.join(
...     unicodedata.normalize(&quot;NFKC&quot;, x) if pattern.match(x) else x
...     for x in re.split(pattern, &quot;!ï½¡ï¼ƒ&quot;.translate(mapping))
... )
'!ã€‚#'</code></pre>
</section>
<section >
<h3>ã‚¯ã‚©ãƒ¼ãƒˆã ã‘æ³¨æ„</h3>
<pre data-id="id19"><code data-trim data-noescape class="python">&gt;&gt;&gt; # å…¨è§’ã«ã—ãŸã‚¯ã‚©ãƒ¼ãƒˆã¯åŠè§’ã«æˆ»ã‚‰ãªã„
&gt;&gt;&gt; unicodedata.normalize(&quot;NFKC&quot;, &quot;â€ï¼…â€™&quot;)
'â€%â€™'
&gt;&gt;&gt; # re.subã§åŠè§’ã«æˆ»ã™
&gt;&gt;&gt; re.sub('[â€™]', &quot;'&quot;, _)  # RIGHT SINGLE QUOTATION MARK
&quot;â€%'&quot;
&gt;&gt;&gt; re.sub('[â€]', '&quot;', _)  # RIGHT DOUBLE QUOTATION MARK
'&quot;%\''</code></pre>
</section>
</section>
<section>
<section >
<h2>ã‚¹ãƒšãƒ¼ã‚¹ã®å‰Šé™¤</h2>
<p>å…ˆé ­ã¨æœ«å°¾ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ä»¥å¤–ã‚‚</p>
<ul class="simple">
<li><p>å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã¯åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«ç½®æ›</p></li>
<li><p>1ã¤ä»¥ä¸Šã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã¯ã€1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«ç½®æ›</p></li>
</ul>
<pre data-id="id20"><code data-trim data-noescape class="python">s = re.sub('[ ã€€]+', ' ', s)</code></pre>
</section>
<section >
<h3><strong>æ–‡å­—åˆ—ä¸­</strong> ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼</h3>
<ul class="simple">
<li><p>ã€Œã²ã‚‰ãŒãªãƒ»å…¨è§’ã‚«ã‚¿ã‚«ãƒŠãƒ»åŠè§’ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ãƒ»å…¨è§’è¨˜å·ã€é–“ã«å«ã¾ã‚Œã‚‹å ´åˆ</p>
<ul>
<li><p>æ¶ˆãˆã‚‹ä¾‹ï¼šã€Œã‚¢ã‚¤ ã® æ­Œå£° ã‚’ è´ã‹ ã› ã¦ã€</p></li>
</ul>
</li>
<li><p>ã€Œã²ã‚‰ãŒãªãƒ»å…¨è§’ã‚«ã‚¿ã‚«ãƒŠãƒ»åŠè§’ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ãƒ»å…¨è§’è¨˜å·ã€ã¨ã€ŒåŠè§’è‹±æ•°å­—ã€ã®é–“ã«å«ã¾ã‚Œã‚‹å ´åˆ</p>
<ul>
<li><p>æ¶ˆãˆã‚‹ä¾‹ï¼šã€Œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  Cã€</p></li>
</ul>
</li>
</ul>
</section>
<section >
<h3>æ­£è¦è¡¨ç¾ã§æ–‡å­—åˆ—ä¸­ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤</h3>
<pre data-id="id22"><code data-trim data-noescape class="python">&gt;&gt;&gt; basic_latin = &quot;\u0000-\u007F&quot;  # åŠè§’è‹±æ•°å­—
&gt;&gt;&gt; # ã€Œã²ã‚‰ãŒãªãƒ»å…¨è§’ã‚«ã‚¿ã‚«ãƒŠãƒ»åŠè§’ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ãƒ»å…¨è§’è¨˜å·ã€
&gt;&gt;&gt; blocks = &quot;&quot;.join(
...     (
...         &quot;\u4E00-\u9FFF&quot;,  # CJK UNIFIED IDEOGRAPHS
...         &quot;\u3040-\u309F&quot;,  # HIRAGANA
...         &quot;\u30A0-\u30FF&quot;,  # KATAKANA
...         &quot;\u3000-\u303F&quot;,  # CJK SYMBOLS AND PUNCTUATION
...         &quot;\uFF00-\uFFEF&quot;,  # HALFWIDTH AND FULLWIDTH FORMS
...     )
... )</code></pre>
</section>
<section >
<h3>æ­£è¦è¡¨ç¾ã®å¾Œæ–¹å‚ç…§</h3>
<pre data-id="id23"><code data-trim data-noescape class="python">&gt;&gt;&gt; pattern = re.compile(&quot;([{}]) ([{}])&quot;.format(blocks, basic_latin))
&gt;&gt;&gt; m = pattern.search(&quot;ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  C&quot;)
&gt;&gt;&gt; m.group(1)
'ãƒ '
&gt;&gt;&gt; m.group(2)
'C'
&gt;&gt;&gt; # \1 ã¯ \g&lt;1&gt; ã¨ç­‰ä¾¡ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ç•ªå·1ãŒãƒãƒƒãƒã—ãŸéƒ¨åˆ†æ–‡å­—åˆ—
&gt;&gt;&gt; pattern.sub(r&quot;\1\2&quot;, &quot;ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  C&quot;)  # åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤
'ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ C'</code></pre>
</section>
<section >
<h3>å¾Œæ–¹å‚ç…§ãŒè¦‹ã¤ã‹ã‚‹é™ã‚Šã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤</h3>
<pre data-id="id24"><code data-trim data-noescape class="python">&gt;&gt;&gt; pattern = re.compile(&quot;([{}]) ([{}])&quot;.format(blocks, blocks))
&gt;&gt;&gt; s = &quot;ã‚¢ã‚¤ ã® æ­Œå£° ã‚’ è´ã‹ ã› ã¦&quot;
&gt;&gt;&gt; while pattern.search(s):
...     s = pattern.sub(r&quot;\1\2&quot;, s)
&gt;&gt;&gt; s
'ã‚¢ã‚¤ã®æ­Œå£°ã‚’è´ã‹ã›ã¦'</code></pre>
<p>åˆ†ã‹ã¡æ›¸ããŒæˆ»ã›ãŸï¼</p>
<aside class="notes">
&gt;&gt;&gt; p = re.compile(&quot;([{}]) ([{}])&quot;.format(basic_latin, blocks))</aside>
<aside class="notes">
&gt;&gt;&gt; s = &quot;ï¼°ï¼²ï¼­ï¼¬ã€€ã€€å‰¯ã€€èª­ã€€æœ¬&quot;  # å…¨è§’ãƒ»åŠè§’ã¨å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã®æ‰±ã„ãŒã„ã‚‹</aside>
<aside class="notes">
&gt;&gt;&gt; while p.search(s):</aside>
<aside class="notes">
...     s = p.sub(r&quot;\1\2&quot;, s)</aside>
<aside class="notes">
&gt;&gt;&gt; s  # å…¨è§’ãƒ»åŠè§’ã¯ä»–ã®å‡¦ç†ã¨åˆã‚ã›ã¦</aside>
<aside class="notes">
'ï¼°ï¼²ï¼­ï¼¬å‰¯èª­æœ¬'</aside>
</section>
</section>
<section>
<section >
<h2>Part 2ï¸âƒ£ çœŸä¼¼ã—ã¦ä½œã‚‹æ­£è¦åŒ–å‡¦ç†</h2>
<p><strong>éƒ¨å“åŒ–</strong> ã—ãŸå‡¦ç†ã‚’ <strong>çµ„åˆã›ã‚‹</strong> å®Ÿè£…ã‚’ææ¡ˆ</p>
</section>
<section >
<h3>å®Œå…¨ã«ç†è§£ã—ãŸï¼</h3>
<ul class="simple">
<li><p>ã€Œè§£æå‰ã«è¡Œã†ã“ã¨ãŒæœ›ã¾ã—ã„æ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†ã€ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã‹ã¯åˆ†ã‹ã£ãŸ</p></li>
<li><p><strong>è‡ªåˆ†ã ã£ãŸã‚‰ã©ã†å®Ÿè£…ã™ã‚‹ã‹</strong> ã‚’è€ƒãˆã¦ã¿ã‚‹</p></li>
<li><p>ã©ã‚“ãªAPIã«ã—ã‚ˆã†ã‹ã€OSSã‚’è¦³å¯Ÿ</p></li>
</ul>
</section>
</section>
<section>
<section >
<h2>ğŸ¤— tokenizers</h2>
<ul class="simple">
<li><p><span class="fab fa-github"></span> <a class="reference external" href="https://github.com/huggingface/tokenizers">https://github.com/huggingface/tokenizers</a></p></li>
<li><p>æ­£è¦åŒ–å‡¦ç†ã‚’ã™ã‚‹ <a class="reference external" href="https://huggingface.co/docs/tokenizers/api/normalizers">Normalizers</a></p></li>
<li><p>Pythonã§ä½¿ãˆã‚‹ã€‚ãŸã ã—ã€Rustå®Ÿè£…ã€‚<a class="reference external" href="https://github.com/huggingface/tokenizers/blob/v0.13.2/bindings/python/py_src/tokenizers/normalizers/__init__.pyi">pyiãƒ•ã‚¡ã‚¤ãƒ«</a> ã‚’ <strong>è¦³å¯Ÿ</strong></p></li>
</ul>
</section>
<section >
<h3>ğŸ”ç™ºè¦‹1ï¼šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã® <strong>çµ±ä¸€</strong></h3>
<ul class="simple">
<li><p>ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ <code class="docutils literal notranslate"><span class="pre">Normalizer</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">normalize_str(text)</span></code> ã¯ text ã‚’æ­£è¦åŒ–ã—ãŸæ–‡å­—åˆ—ã‚’è¿”ã™</p></li>
</ul>
</section>
<section >
<h3>ğŸ”ç™ºè¦‹2ï¼šæ­£è¦åŒ–å‡¦ç†ã® <strong>éƒ¨å“åŒ–</strong></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NFKC</span></code> ï¼šUnicodeæ­£è¦åŒ–å‡¦ç†ã ã‘ã™ã‚‹Normalizer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Strip</span></code> ã‚„ <code class="docutils literal notranslate"><span class="pre">Replace</span></code> ãªã©</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Normalizer</span></code> ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§ã€ã©ã‚Œã‚‚ <code class="code docutils literal notranslate"><span class="pre">normalize_str</span></code> ã‚’å‘¼ã³å‡ºã›ã°ã‚ˆã„</p></li>
</ul>
</section>
<section >
<h3><code class="docutils literal notranslate"><span class="pre">Sequence</span></code> ãŒã«ãã„</h3>
<ul class="simple">
<li><p><strong>ã„ãã¤ã‹ã®æ­£è¦åŒ–å‡¦ç†ã‚’ã¾ã¨ã‚ãŸæ­£è¦åŒ–å‡¦ç†</strong> ã‚’è¡¨ã™</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Normalizer</span></code> ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§ <code class="code docutils literal notranslate"><span class="pre">normalize_str</span></code> ã‚’å‘¼ã³å‡ºã›ã°ã‚ˆã„</p></li>
</ul>
</section>
</section>
<section>
<section >
<h2>ä»Šå›ã¯ <strong>Protocol</strong> ã§ï¼ˆç´ æŒ¯ã‚Šï¼‰</h2>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">typing.Protocol</span></code> <a class="reference external" href="https://docs.python.org/ja/3/library/typing.html#typing.Protocol">https://docs.python.org/ja/3/library/typing.html#typing.Protocol</a></p></li>
<li><p>ãƒ€ãƒƒã‚¯ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚’è¡¨ã›ã‚‹å‹ãƒ’ãƒ³ãƒˆï¼ˆã¨ã„ã†ç†è§£ï¼‰</p></li>
<li><p>æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ <code class="code docutils literal notranslate"><span class="pre">abc.ABC</span></code> ã‚’ä½¿ã£ã¦ã‚‚å…¨ç„¶ã§ãã‚‹ã¨æ€ã„ã¾ã™</p></li>
</ul>
</section>
<section >
<h3><code class="docutils literal notranslate"><span class="pre">Normalizer</span></code> ãƒ—ãƒ­ãƒˆã‚³ãƒ«</h3>
<pre data-id="normalizer"><code data-trim data-noescape class="python">&#64;runtime_checkable
class Normalizer(Protocol):
    def normalize(self, text: str) -&gt; str:
        ...
</code></pre>
<aside class="notes">
doctestã‚’é€šã™ãŸã‚ã®setUp
&gt;&gt;&gt; from typing import Protocol, runtime_checkable
&gt;&gt;&gt; &#64;runtime_checkable
... class Normalizer(Protocol):
...     def normalize(self, text: str) -&gt; str:
...         ...</aside>
</section>
<section >
<h3>è£œè¶³æƒ…å ±ğŸƒâ€â™‚ï¸</h3>
<p><code class="code docutils literal notranslate"><span class="pre">normalize</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Œã°ï¼ˆç¶™æ‰¿ã—ã¦ã„ãªãã¦ã‚‚ï¼‰Normalizer</p>
<pre data-id="id28"><code data-trim data-noescape class="python">&gt;&gt;&gt; class C:
...   def normalize(self, text: str) -&gt; str:
...     return &quot;spam&quot;
&gt;&gt;&gt; issubclass(C, Normalizer), isinstance(C(), Normalizer)
(True, True)
&gt;&gt;&gt; class D:
...   ...
&gt;&gt;&gt; issubclass(D, Normalizer)
False
&gt;&gt;&gt; class E:
...   def normalize(self):  # ã‚·ã‚°ãƒãƒãƒ£ã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ä¸€è‡´ã—ãªã„
...     return &quot;e&quot;
&gt;&gt;&gt; issubclass(E, Normalizer), isinstance(E(), Normalizer)
(True, True)</code></pre>
</section>
<section >
<h3>å…·ä½“ Normalizer ãŸã¡</h3>
<pre data-id="id29"><code data-trim data-noescape class="python">class Strip(Normalizer):
    def normalize(self, text: str) -&gt; str:
        return text.strip()
</code></pre>
<pre data-id="id29"><code data-trim data-noescape class="python">class Replace(Normalizer):
    def __init__(self, pattern, repl) -&gt; None:
        self.pattern = pattern
        self.repl = repl

    def normalize(self, text: str) -&gt; str:
        return re.sub(self.pattern, self.repl, text)
</code></pre>
</section>
<section >
<h3>NormalizerãŸã¡ã‚’ã¾ã¨ã‚ä¸Šã’ã‚‹ <code class="docutils literal notranslate"><span class="pre">Sequence</span></code></h3>
<pre data-id="normalizer-sequence"><code data-trim data-noescape class="python">class Sequence(Normalizer):
    &quot;&quot;&quot;
    &gt;&gt;&gt; sut = Sequence([Lowercase(), NFKC()])
    &gt;&gt;&gt; sut.normalize(&quot;NikkiE&quot;)
    'nikkie'
    &gt;&gt;&gt; sut.normalize(&quot;&quot;.join([chr(0X30D5), chr(0X309A), chr(0X30ED)]))
    'ãƒ—ãƒ­'
    &quot;&quot;&quot;

    def __init__(self, normalizers: AbcSequence[Normalizer]) -&gt; None:
        self.normalizers = normalizers

    def normalize(self, text: str) -&gt; str:
        normalized = text
        for normalizer in self.normalizers:
            normalized = normalizer.normalize(normalized)
        return normalized
</code></pre>
</section>
<section >
<h3>æ–‡å­—åˆ—ä¸­ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹Normalizer</h3>
<pre data-id="id30"><code data-trim data-noescape class="python">class RemoveExtraSpaces(Normalizer):
    BLOCKS = &quot;&quot;.join(
        (
            &quot;\u4E00-\u9FFF&quot;,  # CJK UNIFIED IDEOGRAPHS
            &quot;\u3040-\u309F&quot;,  # HIRAGANA
            &quot;\u30A0-\u30FF&quot;,  # KATAKANA
            &quot;\u3000-\u303F&quot;,  # CJK SYMBOLS AND PUNCTUATION
            &quot;\uFF00-\uFFEF&quot;,  # HALFWIDTH AND FULLWIDTH FORMS
        )
    )
    BASIC_LATIN = &quot;\u0000-\u007F&quot;

    def __init__(self):
        self.normalizer = Sequence(
            [
                Replace(&quot;[ ã€€]+&quot;, &quot; &quot;),
                RemoveSpaceBetween(self.BLOCKS, self.BLOCKS),
                RemoveSpaceBetween(self.BLOCKS, self.BASIC_LATIN),
                RemoveSpaceBetween(self.BASIC_LATIN, self.BLOCKS),
            ]
        )

    def normalize(self, text: str) -&gt; str:
        return self.normalizer.normalize(text)
</code></pre>
</section>
<section >
<h3>ãµã‚‹ã¾ã„ã¯åŒã˜ã§ã™ï¼ğŸ™Œ</h3>
<pre data-id="id31"><code data-trim data-noescape class="python">def normalize_neologd(s):
    normalizer = NeologdNormalizer()
    return normalizer.normalize(s)


if __name__ == &quot;__main__&quot;:
    assert &quot;0123456789&quot; == normalize_neologd(&quot;ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™&quot;)
    assert &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; == normalize_neologd(
        &quot;ï¼¡ï¼¢ï¼£ï¼¤ï¼¥ï¼¦ï¼§ï¼¨ï¼©ï¼ªï¼«ï¼¬ï¼­ï¼®ï¼¯ï¼°ï¼±ï¼²ï¼³ï¼´ï¼µï¼¶ï¼·ï¼¸ï¼¹ï¼º&quot;
    )
</code></pre>
</section>
</section>
<section>
<section >
<h2>ã¾ã¨ã‚ğŸŒ¯ï¼š <code class="docutils literal notranslate"><span class="pre">Norm&#64;lizer</span></code></h2>
<ul class="simple">
<li><p>mecab-ipadic-NEologdã®æ–‡å­—åˆ—ã®æ­£è¦åŒ–å‡¦ç†ã‚’ç†è§£ã—ã€çœŸä¼¼ãŸ</p></li>
<li><p>æ­£è¦è¡¨ç¾ã‚„ <code class="code docutils literal notranslate"><span class="pre">str.translate</span></code> ã‚’é§†ä½¿ã—ã¦æ­£è¦åŒ–ã—ã¦ã„ã‚‹</p></li>
<li><p>ğŸ¤—/tokenizersã‚’å‚è€ƒã«ã—ã€å‡¦ç†ã‚’éƒ¨å“åŒ–ã—ãŸå®Ÿè£…ã‚’ææ¡ˆ</p></li>
</ul>
</section>
<section >
<h3>ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h3>
<p>ã•ã‚ˆãªã‚‰2022å¹´ï¼ï¼ï¼ğŸ¯</p>
<p>mecab-ipadic-NEologdã€å­¦ã³ã‚’ã‚ã‚ŠãŒã¨ã†ï¼</p>
</section>
</section>
<section >
<h2>Appendix é–¢é€£ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</h2>
<ul class="simple">
<li><p><span class="fab fa-github"></span> <a class="reference external" href="https://github.com/ftnext/2022_slides/blob/main/samplecode/normalizers/assembled.py">ææ¡ˆå®Ÿè£…</a></p></li>
<li><p>Part2ã¨é–¢é€£ï¼š <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/entry/observe-huggingface-tokenizers-normalizers">huggingface/tokenizersã®Normalizerè¦³å¯Ÿè¨˜ ã€œå‡¦ç†ã®éƒ¨å“åŒ–ã¨çµ±ä¸€ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€œ</a></p></li>
</ul>
</section>
<section >
<h2>EOF</h2>
</section>

        </div>
    </div>
    
    <script src="../_static/revealjs4/dist/reveal.js"></script>
    
    
      <script src="../_static/revealjs4/plugin/highlight/highlight.js"></script>
      <script src="../_static/revealjs4/plugin/notes/notes.js"></script>
      
    
    <script>
        var revealjsConfig = new Object();
        Object.assign(revealjsConfig, 
    {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: "none",
        slideNumber: "c/t",
    }
);
        
        
        
          revealjsConfig.plugins = [
            RevealHighlight,RevealNotes,
          ];
        
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize(revealjsConfig);
    </script>

  </body>
</html>