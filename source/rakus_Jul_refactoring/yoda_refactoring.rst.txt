ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° with é”äºº
============================================================

.. literalinclude:: ../../samplecode/refactoring/before.py
    :language: python
    :linenos:

åˆæ‰‹ï¼š ``transform_letter`` é–¢æ•°ã«å¼•æ•°è¿½åŠ 
--------------------------------------------------

.. code-block:: diff

    -        result += transform_letter(char_code)
    +        result += transform_letter(character, char_code)

    -def transform_letter(char_code: int) -> str:
    +def transform_letter(letter: str, char_code: int) -> str:

.. include:: tests_passed.rst.txt

2æ‰‹ç›®ï¼š ``is_between`` é–¢æ•°ã«å¼•æ•°è¿½åŠ 
--------------------------------------------------

.. code-block:: diff

    -    if is_between(char_code, "a", "m") or is_between(char_code, "A", "M"):
    +    if is_between(letter, char_code, "a", "m") or is_between(letter, char_code, "A", "M"):

    -    elif is_between(char_code, "n", "z") or is_between(char_code, "N", "Z"):
    +    elif is_between(letter, char_code, "n", "z") or is_between(letter, char_code, "N", "Z"):

    -def is_between(char_code: int, first_letter: str, last_letter: str) -> bool:
    +def is_between(letter: str, char_code: int, first_letter: str, last_letter: str) -> bool:

.. include:: tests_passed.rst.txt

3æ‰‹ç›®ï¼š **æ–‡å­—ã®æ¯”è¼ƒ** ã«å®Ÿè£…ã‚’å¤‰æ›´ï¼ˆ ``is_between`` é–¢æ•°ï¼‰
------------------------------------------------------------

ã¤ã„ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å®Ÿæ–½

.. code-block:: diff

    -    return code_for(first_letter) <= char_code <= code_for(last_letter)
    +    return first_letter <= letter <= last_letter

.. include:: tests_passed.rst.txt

4æ‰‹ç›®ï¼š ä½¿ã‚ãªããªã£ãŸ ``code_for`` é–¢æ•°ã‚’å‰Šé™¤
--------------------------------------------------

.. code-block:: diff

    -def code_for(letter: str) -> int:
    -    return ord(letter)

.. include:: tests_passed.rst.txt

5æ‰‹ç›®ï¼š ``is_between`` é–¢æ•°ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
--------------------------------------------------

ã„ã¾ã® ``is_between`` é–¢æ•°ã®æœ¬ä½“ã¯ **åå‰ã¨åŒã˜ãã‚‰ã„åˆ†ã‹ã‚Šã‚„ã™ã„**ï¼

.. code-block:: diff

    -    if is_between(letter, char_code, "a", "m") or is_between(letter, char_code, "A", "M"):
    +    if ("a" <= letter <= "m") or ("A" <= letter <= "M"):
    -    elif is_between(letter, char_code, "n", "z") or is_between(letter, char_code, "N", "Z"):
    +    elif ("n" <= letter <= "z") or ("N" <= letter <= "Z"):

    -def is_between(letter: str, char_code: int, first_letter: str, last_letter: str) -> bool:
    -    return first_letter <= letter <= last_letter

.. include:: tests_passed.rst.txt

6æ‰‹ç›®ï¼š ``transform_letter`` é–¢æ•°ã§ ``letter`` ã‹ã‚‰ ``char_code`` ã‚’ä½œã‚Œã‚‹
--------------------------------------------------------------------------------

å¼•æ•° ``char_code`` ã‚’æ¶ˆã™å‰ã®ã‚¹ãƒ†ãƒƒãƒ—

.. code-block:: diff

    def transform_letter(letter: str, char_code: int) -> str:
    +    char_code = ord(letter)

.. include:: tests_passed.rst.txt

7æ‰‹ç›®ï¼š ``char_code`` å¼•æ•°å‰Šé™¤
--------------------------------------------------

.. code-block:: diff

    -        char_code = ord(character)
    -        result += transform_letter(character, char_code)
    +        result += transform_letter(character)

    -def transform_letter(letter: str, char_code: int) -> str:
    +def transform_letter(letter: str) -> str:

.. include:: tests_passed.rst.txt

ã“ã®æ™‚ç‚¹ã‚‚ã ã„ã¶ã‚¹ãƒƒã‚­ãƒªâœ¨
--------------------------------------------------

.. literalinclude:: ../../samplecode/refactoring/intermediate.py
    :language: python
    :linenos:

ã•ã‚‰ãªã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢
============================================================

* æ­£è¦è¡¨ç¾ ``r"[A-Za-z]"`` ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—ã ã‘ç½®ãæ›ãˆã‚‹
* Pythonã§ã¯ ``re.sub`` ã«é–¢æ•°ã‚’æ¸¡ã™ï¼ˆ``transform_letter`` ã‚’æ¸¡ã™ï¼‰

https://docs.python.org/ja/3/library/re.html#re.sub

.. code-block:: python

    re.sub(r"[A-Za-z]", ãƒãƒƒãƒã—ãŸå„æ–‡å­—ã‚’å¤‰æ›ã™ã‚‹é–¢æ•°, å¯¾è±¡æ–‡å­—åˆ—)

æ­£è¦è¡¨ç¾å°å…¥
--------------------------------------------------

.. code-block:: diff

    +import re

    -    result = ""
    -    for character in input_:
    -        result += transform_letter(character)
    -    return result
    +    return re.sub(
    +        r"[A-Za-z]",
    +        lambda matchobj: transform_letter(matchobj.group(0)),
    +        input_,
    +    )

.. include:: tests_passed.rst.txt

``transform_letter`` ã®ifæ–‡ã‚’å˜ç´”ã«ï¼ˆWIPï¼‰
--------------------------------------------------

æ­£è¦è¡¨ç¾ã‚’ä½¿ã£ãŸã“ã¨ã§ã€ **A-Za-zã§ã®ã¿** ``transform_letter`` é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹

.. code-block:: diff

    -    if ("a" <= letter <= "m") or ("A" <= letter <= "M"):
    +    if letter.upper() <= "M":

.. include:: tests_passed.rst.txt

``transform_letter`` ã®ifæ–‡ã‚’å˜ç´”ã«
--------------------------------------------------

.. code-block:: diff

    -    elif ("n" <= letter <= "z") or ("N" <= letter <= "Z"):
    +    else:

.. include:: tests_passed.rst.txt

``transform_letter`` ã®å‡¦ç†ã« ``rotation`` å¤‰æ•°å°å…¥
------------------------------------------------------------

ä½•æ–‡å­—ã ã‘æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã‹ã‚’è¡¨ã™å¤‰æ•°

.. code-block:: diff

         char_code = ord(letter)
         if letter.upper() <= "M":
             char_code += 13
    +        rotation = 13
         else:
             char_code -= 13
    +        rotation = -13

.. include:: tests_passed.rst.txt

``char_code`` å¤‰æ•°ã«å†ä»£å…¥ã—ãªã„ï¼ˆ ``transform_letter`` é–¢æ•°ï¼‰
----------------------------------------------------------------------

.. code-block:: diff

         char_code = ord(letter)
         if letter.upper() <= "M":
    -        char_code += 13
             rotation = 13
         else:
    -        char_code -= 13
             rotation = -13
    -    return chr(char_code)
    +    return chr(char_code + rotation)

.. include:: tests_passed.rst.txt

``char_code`` å¤‰æ•°ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ï¼ˆ ``transform_letter`` é–¢æ•°ï¼‰
----------------------------------------------------------------------

.. code-block:: diff

    -    char_code = ord(letter)

    -    return chr(char_code + rotation)
    +    return chr(ord(letter) + rotation)

.. include:: tests_passed.rst.txt

æ¡ä»¶å¼ã‚’ä½¿ã£ã¦ ``if`` æ–‡ã‚’æ¶ˆã™
--------------------------------------------------

Pythonã«é¦´æŸ“ã¿ã®ãªã„æ–¹ã¸ã€æ¡ä»¶å¼ã¯ *ä¸‰é …æ¼”ç®—å­* ã ã¨æ€ã£ã¦ãã ã•ã„

.. code-block:: diff

    -    if letter.upper() <= "M":
    -        rotation = 13
    -    else:
    -        rotation = -13
    +    rotation = 13 if letter.upper() <= "M" else -13

.. include:: tests_passed.rst.txt

å°ã•ã„ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç©ã¿é‡ã­ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§ããŸï¼ï¼ğŸ™Œ
------------------------------------------------------------

.. literalinclude:: ../../samplecode/refactoring/after.py
    :language: python
    :linenos:
